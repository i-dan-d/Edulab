<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="C√¥ng c·ª• gi√°o vi√™n - T√πy ch·ªânh h∆∞·ªõng d·∫´n v√† m·ª•c ti√™u h·ªçc t·∫≠p cho th√≠ nghi·ªám PhET">
    <meta name="robots" content="noindex, nofollow">
    
    <title>C√¥ng c·ª• Gi√°o vi√™n - EduLab</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/completion-status.css">
    <link rel="stylesheet" href="css/teacher-interface.css">
    <link rel="stylesheet" href="css/simulation-manager.css">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://phet.colorado.edu">
</head>
<body>

    <!-- Skip to main content for accessibility -->
    <a href="#teacher-content" class="skip-link">Chuy·ªÉn ƒë·∫øn n·ªôi dung ch√≠nh</a>

    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-container">
            <div class="header-brand">
                <a href="index.html" class="brand-link" aria-label="Tr·ªü v·ªÅ trang ch·ªß EduLab">
                    <h1 class="brand-title">EduLab</h1>
                    <span class="brand-subtitle">C√¥ng c·ª• Gi√°o vi√™n</span>
                </a>
            </div>
            
            <nav class="header-nav" role="navigation" aria-label="ƒêi·ªÅu h∆∞·ªõng ch√≠nh">
                <ul class="nav-list">
                    <li><a href="index.html" class="nav-link">üè† Trang ch·ªß</a></li>
                    <li><a href="browse.html" class="nav-link">üîç Th∆∞ vi·ªán</a></li>
                    <li><a href="teacher-tools.html" class="nav-link active">üë®‚Äçüè´ C√¥ng c·ª• GV</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main content -->
    <main id="teacher-content" class="main" role="main">
        <div class="teacher-container">
            
            <!-- Page header -->
            <div class="teacher-header">
                <h2 class="teacher-title">üë®‚Äçüè´ C√¥ng c·ª• Gi√°o vi√™n</h2>
                <p class="teacher-subtitle">
                    T√πy ch·ªânh h∆∞·ªõng d·∫´n v√† m·ª•c ti√™u h·ªçc t·∫≠p cho t·ª´ng th√≠ nghi·ªám. 
                    T·∫•t c·∫£ thay ƒë·ªïi ƒë∆∞·ª£c l∆∞u tr·ªØ c·ª•c b·ªô tr√™n m√°y t√≠nh c·ªßa b·∫°n.
                </p>
            </div>

            <!-- Teacher session info -->
            <div id="teacher-session-container">
                <!-- Session info will be rendered here by JavaScript -->
            </div>

            <!-- Navigation tabs -->
            <div class="teacher-nav-tabs">
                <button class="nav-tab active" onclick="switchTab('customization')" id="tab-customization">
                    ‚úèÔ∏è T√πy ch·ªânh th√≠ nghi·ªám
                </button>
                <button class="nav-tab" onclick="switchTab('management')" id="tab-management">
                    üõ†Ô∏è Qu·∫£n l√Ω th√≠ nghi·ªám
                </button>
            </div>

            <!-- Customization Tab Content -->
            <section class="tab-content active" id="customization-tab">
                <!-- Action buttons -->
                <div class="teacher-actions">
                <button id="import-btn" class="teacher-btn secondary" onclick="importCustomizations()">
                    üì• Nh·∫≠p d·ªØ li·ªáu
                </button>
                <button id="export-btn" class="teacher-btn secondary" onclick="exportCustomizations()">
                    üì§ Xu·∫•t d·ªØ li·ªáu
                </button>
                <button id="reset-btn" class="teacher-btn danger" onclick="resetAllCustomizations()">
                    üîÑ ƒê·∫∑t l·∫°i t·∫•t c·∫£
                </button>
            </div>

            <!-- Simulation selector -->
            <div class="simulation-selector">
                <h3 class="section-title">üìã Ch·ªçn th√≠ nghi·ªám ƒë·ªÉ t√πy ch·ªânh</h3>
                
                <!-- Subject filter -->
                <div class="subject-filter">
                    <label for="subject-select" class="filter-label">M√¥n h·ªçc:</label>
                    <select id="subject-select" class="filter-select" onchange="filterSimulations()">
                        <option value="">T·∫•t c·∫£ m√¥n h·ªçc</option>
                        <option value="physics">V·∫≠t l√Ω</option>
                        <option value="chemistry">H√≥a h·ªçc</option>
                        <option value="biology">Sinh h·ªçc</option>
                        <option value="mathematics">To√°n h·ªçc</option>
                    </select>
                </div>

                <!-- Search -->
                <div class="search-container">
                    <label for="simulation-search" class="search-label">T√¨m ki·∫øm th√≠ nghi·ªám:</label>
                    <div style="position: relative; display: flex; gap: 8px;">
                        <input type="text" id="simulation-search" class="search-input" 
                               placeholder="T√¨m ki·∫øm: forces, l·ª±c, motion, ƒëi·ªán, chemistry..." 
                               oninput="searchSimulations()"
                               onkeyup="searchSimulations()"
                               aria-describedby="search-help"
                               style="flex: 1;">
                        <button type="button" onclick="clearSearch()" class="teacher-btn secondary" 
                                style="padding: 8px 16px; min-width: auto;">
                            üóëÔ∏è X√≥a
                        </button>
                    </div>
                    <div id="search-help" class="search-help">
                        T√¨m ki·∫øm theo t√™n, m√¥ t·∫£, ch·ªß ƒë·ªÅ th√≠ nghi·ªám. H·ªó tr·ª£ ti·∫øng Vi·ªát v√† ti·∫øng Anh.<br>
                        <strong>V√≠ d·ª•:</strong> "l·ª±c", "forces", "motion", "ƒëi·ªán", "h√≥a h·ªçc", "acid"
                    </div>
                </div>

                <!-- Search status -->
                <div id="search-status" class="search-status" style="display: none; margin-bottom: 16px; padding: 12px; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; color: #0369a1;">
                    <!-- Search status will be shown here -->
                </div>

                <!-- Simulation list -->
                <div id="simulation-list" class="simulation-list" role="list">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>ƒêang t·∫£i danh s√°ch th√≠ nghi·ªám...</p>
                    </div>
                </div>
            </div>
            </section>

            <!-- Management Tab Content -->
            <section class="tab-content" id="management-tab">
                <!-- Simulation Management Section -->
                <div class="simulation-manager" id="simulation-management">
                <div class="manager-header">
                    <h2 class="manager-title">
                        üõ†Ô∏è Qu·∫£n l√Ω Th√≠ nghi·ªám T√πy ch·ªânh
                    </h2>
                    <div class="manager-actions">
                        <button type="button" class="btn-secondary-large" onclick="toggleAddForm()">
                            ‚ûï Th√™m th√≠ nghi·ªám
                        </button>
                        <button type="button" class="btn-secondary-large" onclick="exportCustomSimulations()">
                            üì• Xu·∫•t d·ªØ li·ªáu
                        </button>
                        <button type="button" class="btn-secondary-large" onclick="showImportDialog()">
                            üì§ Nh·∫≠p d·ªØ li·ªáu
                        </button>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number" id="total-custom-sims">0</span>
                        <span class="stat-label">Th√≠ nghi·ªám t√πy ch·ªânh</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="recent-additions">0</span>
                        <span class="stat-label">Th√™m g·∫ßn ƒë√¢y (7 ng√†y)</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="total-collections">0</span>
                        <span class="stat-label">B·ªô s∆∞u t·∫≠p</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="total-access">0</span>
                        <span class="stat-label">L∆∞·ª£t truy c·∫≠p</span>
                    </div>
                </div>

                <!-- Add Simulation Form -->
                <div class="add-simulation-form" id="add-simulation-form" style="display: none;">
                    <form id="simulation-form" onsubmit="addCustomSimulation(event)">
                        
                        <!-- Form Header -->
                        <div class="form-header" style="text-align: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid var(--accent-color);">
                            <h2 style="color: var(--accent-color); margin-bottom: 0.5rem;">‚ûï Th√™m th√≠ nghi·ªám PhET t√πy ch·ªânh</h2>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0;">
                                Nh·∫•n <kbd style="background: var(--bg-light); padding: 2px 6px; border-radius: 4px; font-size: 0.8rem;">ESC</kbd> ho·∫∑c click b√™n ngo√†i ƒë·ªÉ ƒë√≥ng
                            </p>
                        </div>

                        <!-- Basic Information -->
                        <div class="form-section">
                            <h3 class="section-title">üìù Th√¥ng tin c∆° b·∫£n</h3>
                            <div class="form-grid">
                                <div class="form-group full-width">
                                    <label for="phet-url" class="form-label required">URL PhET Simulation</label>
                                    <input type="url" id="phet-url" name="phetUrl" class="form-input" 
                                           placeholder="https://phet.colorado.edu/sims/html/..." 
                                           onblur="validatePhETURL()" required>
                                    <div id="url-validation" class="url-validation" style="display: none;">
                                        <div class="validation-message">
                                            <span id="validation-icon">‚è≥</span>
                                            <span id="validation-text">ƒêang ki·ªÉm tra URL...</span>
                                        </div>
                                        <div id="validation-suggestion" class="validation-suggestion"></div>
                                        <div id="url-metadata" class="metadata-display" style="display: none;"></div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="sim-title" class="form-label required">Ti√™u ƒë·ªÅ (Ti·∫øng Vi·ªát)</label>
                                    <input type="text" id="sim-title" name="title" class="form-input" 
                                           placeholder="V√≠ d·ª•: L·ª±c v√† Chuy·ªÉn ƒë·ªông C∆° b·∫£n" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="sim-subject" class="form-label required">M√¥n h·ªçc</label>
                                    <select id="sim-subject" name="subject" class="form-select" required>
                                        <option value="">Ch·ªçn m√¥n h·ªçc</option>
                                        <option value="physics">V·∫≠t l√Ω</option>
                                        <option value="chemistry">H√≥a h·ªçc</option>
                                        <option value="biology">Sinh h·ªçc</option>
                                        <option value="mathematics">To√°n h·ªçc</option>
                                    </select>
                                </div>
                                
                                <div class="form-group full-width">
                                    <label for="sim-description" class="form-label required">M√¥ t·∫£</label>
                                    <textarea id="sim-description" name="description" class="form-textarea" 
                                              placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ th√≠ nghi·ªám n√†y..." required></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Educational Information -->
                        <div class="form-section">
                            <h3 class="section-title">üéì Th√¥ng tin gi√°o d·ª•c</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label required">C·∫•p l·ªõp ph√π h·ª£p</label>
                                    <div class="grade-level-container">
                                        <div class="grade-level-checkbox">
                                            <input type="checkbox" id="grade-6" name="gradeLevel" value="6">
                                            <label for="grade-6">L·ªõp 6</label>
                                        </div>
                                        <div class="grade-level-checkbox">
                                            <input type="checkbox" id="grade-7" name="gradeLevel" value="7">
                                            <label for="grade-7">L·ªõp 7</label>
                                        </div>
                                        <div class="grade-level-checkbox">
                                            <input type="checkbox" id="grade-8" name="gradeLevel" value="8">
                                            <label for="grade-8">L·ªõp 8</label>
                                        </div>
                                        <div class="grade-level-checkbox">
                                            <input type="checkbox" id="grade-9" name="gradeLevel" value="9">
                                            <label for="grade-9">L·ªõp 9</label>
                                        </div>
                                        <div class="grade-level-checkbox">
                                            <input type="checkbox" id="grade-10" name="gradeLevel" value="10">
                                            <label for="grade-10">L·ªõp 10</label>
                                        </div>
                                        <div class="grade-level-checkbox">
                                            <input type="checkbox" id="grade-11" name="gradeLevel" value="11">
                                            <label for="grade-11">L·ªõp 11</label>
                                        </div>
                                        <div class="grade-level-checkbox">
                                            <input type="checkbox" id="grade-12" name="gradeLevel" value="12">
                                            <label for="grade-12">L·ªõp 12</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="sim-difficulty" class="form-label">ƒê·ªô kh√≥</label>
                                    <select id="sim-difficulty" name="difficulty" class="form-select">
                                        <option value="beginner">C∆° b·∫£n</option>
                                        <option value="intermediate">Trung b√¨nh</option>
                                        <option value="advanced">N√¢ng cao</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="sim-duration" class="form-label">Th·ªùi gian (ph√∫t)</label>
                                    <input type="number" id="sim-duration" name="duration" class="form-input" 
                                           min="5" max="120" placeholder="30">
                                </div>
                                
                                <div class="form-group full-width">
                                    <label for="sim-topics" class="form-label">Ch·ªß ƒë·ªÅ</label>
                                    <input type="text" id="sim-topics" name="topics" class="form-input" 
                                           placeholder="V√≠ d·ª•: L·ª±c, Chuy·ªÉn ƒë·ªông, NƒÉng l∆∞·ª£ng (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y)">
                                </div>
                                
                                <div class="form-group full-width">
                                    <label for="sim-objectives" class="form-label">M·ª•c ti√™u h·ªçc t·∫≠p</label>
                                    <textarea id="sim-objectives" name="learningObjectives" class="form-textarea" 
                                              placeholder="H·ªçc sinh s·∫Ω h·ªçc ƒë∆∞·ª£c g√¨ t·ª´ th√≠ nghi·ªám n√†y?"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Tags and Collections -->
                        <div class="form-section">
                            <h3 class="section-title">üè∑Ô∏è Ph√¢n lo·∫°i</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">T·ª´ kh√≥a</label>
                                    <div class="tags-container" id="tags-container">
                                        <input type="text" class="tag-input" placeholder="Th√™m t·ª´ kh√≥a..." 
                                               onkeypress="addTag(event)">
                                    </div>
                                    <input type="hidden" id="sim-tags" name="tags">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">B·ªô s∆∞u t·∫≠p</label>
                                    <div class="collections-grid" id="collections-selection">
                                        <!-- Collections will be populated here -->
                                    </div>
                                    <input type="hidden" id="sim-collections" name="collections">
                                </div>
                            </div>
                        </div>

                        <!-- Preview Section -->
                        <div class="preview-section">
                            <div class="preview-header">
                                <h3 class="preview-title">üëÅÔ∏è Xem tr∆∞·ªõc th√≠ nghi·ªám</h3>
                                <button type="button" class="btn-secondary-large" onclick="previewSimulation()">
                                    üîÑ L√†m m·ªõi
                                </button>
                            </div>
                            <div class="preview-container" id="preview-container">
                                <div class="preview-placeholder">
                                    Nh·∫≠p URL h·ª£p l·ªá ƒë·ªÉ xem tr∆∞·ªõc th√≠ nghi·ªám
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <button type="button" class="btn-secondary-large" onclick="cancelAddForm()">
                                ‚ùå H·ªßy b·ªè
                            </button>
                            <button type="submit" class="btn-primary-large" id="submit-btn">
                                ‚úÖ Th√™m th√≠ nghi·ªám
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Custom Simulations List -->
                <div class="custom-simulations-list">
                    <div class="simulations-header">
                        <h3>üìö Th√≠ nghi·ªám t√πy ch·ªânh</h3>
                        <div class="manager-actions">
                            <button type="button" class="btn-secondary-large" onclick="refreshCustomSimulations()">
                                üîÑ L√†m m·ªõi
                            </button>
                        </div>
                    </div>
                    
                    <div class="simulations-grid" id="custom-simulations-grid">
                        <div class="empty-state">
                            <div class="empty-state-icon">üéØ</div>
                            <div class="empty-state-title">Ch∆∞a c√≥ th√≠ nghi·ªám t√πy ch·ªânh</div>
                            <div class="empty-state-description">
                                Th√™m th√≠ nghi·ªám PhET t√πy ch·ªânh ƒë·ªÉ m·ªü r·ªông th∆∞ vi·ªán c·ªßa b·∫°n
                            </div>
                            <button type="button" class="btn-primary-large" onclick="toggleAddForm()">
                                ‚ûï Th√™m th√≠ nghi·ªám ƒë·∫ßu ti√™n
                            </button>
                        </div>
                    </div>
                </div>
                </div>
            </section>

            <!-- Customization editor -->
            <div id="customization-editor" class="customization-editor" style="display: none;">
                <div class="editor-header">
                    <h3 class="editor-title">‚úèÔ∏è T√πy ch·ªânh th√≠ nghi·ªám</h3>
                    <button id="close-editor-btn" class="close-btn" onclick="closeEditor()" aria-label="ƒê√≥ng tr√¨nh ch·ªânh s·ª≠a">
                        ‚úï
                    </button>
                </div>

                <!-- Simulation info -->
                <div id="simulation-info" class="simulation-info">
                    <!-- Will be populated by JavaScript -->
                </div>

                <!-- Custom learning objectives -->
                <div class="editor-section">
                    <label for="custom-objectives" class="editor-label">
                        üéØ M·ª•c ti√™u h·ªçc t·∫≠p t√πy ch·ªânh
                    </label>
                    <div class="editor-toolbar">
                        <button type="button" class="toolbar-btn" onclick="formatText('custom-objectives', 'bold')" title="In ƒë·∫≠m">
                            <strong>B</strong>
                        </button>
                        <button type="button" class="toolbar-btn" onclick="formatText('custom-objectives', 'italic')" title="In nghi√™ng">
                            <em>I</em>
                        </button>
                        <button type="button" class="toolbar-btn" onclick="formatText('custom-objectives', 'list')" title="Danh s√°ch">
                            üìã
                        </button>
                        <button type="button" class="toolbar-btn" onclick="formatText('custom-objectives', 'link')" title="Li√™n k·∫øt">
                            üîó
                        </button>
                    </div>
                    <textarea id="custom-objectives" class="editor-textarea" 
                              placeholder="Nh·∫≠p m·ª•c ti√™u h·ªçc t·∫≠p t√πy ch·ªânh c·ªßa b·∫°n...&#10;&#10;V√≠ d·ª•:&#10;- H·ªçc sinh c√≥ th·ªÉ gi·∫£i th√≠ch kh√°i ni·ªám l·ª±c&#10;- H·ªçc sinh c√≥ th·ªÉ √°p d·ª•ng ƒë·ªãnh lu·∫≠t Newton&#10;- H·ªçc sinh c√≥ th·ªÉ ph√¢n t√≠ch chuy·ªÉn ƒë·ªông"
                              rows="6"
                              oninput="saveCustomization()"></textarea>
                    <div class="editor-help">
                        S·ª≠ d·ª•ng markdown ƒë∆°n gi·∫£n: **in ƒë·∫≠m**, *in nghi√™ng*, - danh s√°ch
                    </div>
                </div>

                <!-- Custom instructions -->
                <div class="editor-section">
                    <label for="custom-instructions" class="editor-label">
                        üìù H∆∞·ªõng d·∫´n t√πy ch·ªânh
                    </label>
                    <div class="editor-toolbar">
                        <button type="button" class="toolbar-btn" onclick="formatText('custom-instructions', 'bold')" title="In ƒë·∫≠m">
                            <strong>B</strong>
                        </button>
                        <button type="button" class="toolbar-btn" onclick="formatText('custom-instructions', 'italic')" title="In nghi√™ng">
                            <em>I</em>
                        </button>
                        <button type="button" class="toolbar-btn" onclick="formatText('custom-instructions', 'list')" title="Danh s√°ch">
                            üìã
                        </button>
                        <button type="button" class="toolbar-btn" onclick="formatText('custom-instructions', 'link')" title="Li√™n k·∫øt">
                            üîó
                        </button>
                        <button type="button" class="toolbar-btn" onclick="formatText('custom-instructions', 'step')" title="B∆∞·ªõc">
                            üìã
                        </button>
                    </div>
                    <textarea id="custom-instructions" class="editor-textarea" 
                              placeholder="Nh·∫≠p h∆∞·ªõng d·∫´n t·ª´ng b∆∞·ªõc cho h·ªçc sinh...&#10;&#10;V√≠ d·ª•:&#10;1. M·ªü th√≠ nghi·ªám v√† quan s√°t giao di·ªán&#10;2. Th·ª≠ thay ƒë·ªïi c√°c th√¥ng s·ªë&#10;3. Ghi ch√∫ nh·ªØng g√¨ quan s√°t ƒë∆∞·ª£c&#10;4. Th·∫£o lu·∫≠n k·∫øt qu·∫£ v·ªõi nh√≥m"
                              rows="8"
                              oninput="saveCustomization()"></textarea>
                    <div class="editor-help">
                        Th√™m h∆∞·ªõng d·∫´n chi ti·∫øt ƒë·ªÉ gi√∫p h·ªçc sinh s·ª≠ d·ª•ng th√≠ nghi·ªám hi·ªáu qu·∫£
                    </div>
                </div>

                <!-- Preview section -->
                <div class="editor-section">
                    <h4 class="preview-title">üëÅÔ∏è Xem tr∆∞·ªõc</h4>
                    <div id="preview-container" class="preview-container">
                        <div class="preview-section">
                            <h5>M·ª•c ti√™u h·ªçc t·∫≠p:</h5>
                            <div id="objectives-preview" class="preview-content">
                                <em>Ch∆∞a c√≥ m·ª•c ti√™u t√πy ch·ªânh</em>
                            </div>
                        </div>
                        <div class="preview-section">
                            <h5>H∆∞·ªõng d·∫´n:</h5>
                            <div id="instructions-preview" class="preview-content">
                                <em>Ch∆∞a c√≥ h∆∞·ªõng d·∫´n t√πy ch·ªânh</em>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action buttons -->
                <div class="editor-actions">
                    <button id="save-btn" class="teacher-btn primary" onclick="saveAndClose()">
                        üíæ L∆∞u v√† ƒë√≥ng
                    </button>
                    <button id="preview-btn" class="teacher-btn secondary" onclick="previewSimulation()">
                        üëÅÔ∏è Xem th√≠ nghi·ªám
                    </button>
                    <button id="clear-btn" class="teacher-btn danger" onclick="clearCustomization()">
                        üóëÔ∏è X√≥a t√πy ch·ªânh
                    </button>
                </div>
            </div>

            <!-- Statistics -->
            <div id="customization-stats" class="customization-stats">
                <h3 class="stats-title">üìä Th·ªëng k√™ t√πy ch·ªânh</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="total-customizations">0</div>
                        <div class="stat-label">Th√≠ nghi·ªám ƒë√£ t√πy ch·ªânh</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="total-objectives">0</div>
                        <div class="stat-label">M·ª•c ti√™u ƒë√£ th√™m</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="total-instructions">0</div>
                        <div class="stat-label">H∆∞·ªõng d·∫´n ƒë√£ th√™m</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="last-updated">Ch∆∞a c√≥</div>
                        <div class="stat-label">C·∫≠p nh·∫≠t l·∫ßn cu·ªëi</div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="footer-container">
            <div class="footer-content">
                <p>&copy; 2024 EduLab - N·ªÅn t·∫£ng Th√≠ nghi·ªám ·∫¢o cho Gi√°o d·ª•c</p>
                <p>ƒê∆∞·ª£c x√¢y d·ª±ng v·ªõi ‚ù§Ô∏è cho gi√°o d·ª•c Vi·ªát Nam</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="js/teacher-auth.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/content-filter.js"></script>
    <script src="js/completion-tracker.js"></script>
    <script src="js/teacher-customization.js"></script>
    <script src="js/instruction-editor.js"></script>
    <script src="js/url-validator.js"></script>
    <script src="js/simulation-manager.js"></script>
    <script src="js/collection-manager.js"></script>
    <script src="js/main.js"></script>
    
    <!-- Teacher tools specific script -->
    <script>
        (function() {
            'use strict';

            let allSimulations = [];
            let filteredSimulations = [];
            let currentSimulation = null;

            /**
             * Ensure managers exist and are initialized
             */
            async function ensureManagersExist() {
                console.log('Ensuring managers exist...');
                
                // Force trigger the auto-initialization scripts
                // The scripts should have already run, but let's make sure
                
                return new Promise((resolve) => {
                    let checkCount = 0;
                    const maxChecks = 20;
                    
                    const checkAndCreate = async () => {
                        checkCount++;
                        console.log(`Check ${checkCount}: Looking for managers...`);
                        
                        // Check if managers exist and are ready
                        const simManagerReady = window.SimulationManager && 
                            typeof window.SimulationManager.isReady === 'function' && 
                            window.SimulationManager.isReady();
                            
                        const colManagerReady = window.CollectionManager && 
                            typeof window.CollectionManager.isReady === 'function' && 
                            window.CollectionManager.isReady();
                            
                        if (simManagerReady && colManagerReady) {
                            console.log('‚úÖ Both managers found and ready!');
                            resolve();
                        } else if (window.SimulationManager && window.CollectionManager && checkCount > 10) {
                            // Managers exist but not ready - try to force initialize them
                            console.log('üîÑ Managers exist but not ready, force initializing...');
                            try {
                                if (!simManagerReady && window.SimulationManager.initialize) {
                                    await window.SimulationManager.initialize();
                                }
                                if (!colManagerReady && window.CollectionManager.initialize) {
                                    await window.CollectionManager.initialize();
                                }
                                console.log('‚úÖ Force initialization completed!');
                                resolve();
                            } catch (error) {
                                console.warn('‚ö†Ô∏è Force initialization failed:', error);
                                // Continue to fallback creation
                            }
                        } else if (checkCount >= maxChecks) {
                            console.log('‚è∞ Max checks reached, creating instances or fallbacks...');
                            
                            // Try to create instances from classes first
                            if (window.SimulationManager && typeof window.SimulationManager === 'function') {
                                try {
                                    console.log('Creating SimulationManager instance from class...');
                                    const manager = new window.SimulationManager();
                                    await manager.initialize();
                                    window.SimulationManager = manager;
                                    console.log('‚úÖ SimulationManager instance created');
                                } catch (error) {
                                    console.error('‚ùå Failed to create SimulationManager instance:', error);
                                }
                            }
                            
                            if (window.CollectionManager && typeof window.CollectionManager === 'function') {
                                try {
                                    console.log('Creating CollectionManager instance from class...');
                                    const manager = new window.CollectionManager();
                                    await manager.initialize();
                                    window.CollectionManager = manager;
                                    console.log('‚úÖ CollectionManager instance created');
                                } catch (error) {
                                    console.error('‚ùå Failed to create CollectionManager instance:', error);
                                }
                            }
                            
                            // Create minimal fallbacks only if still not available
                            if (!window.SimulationManager || typeof window.SimulationManager.isReady !== 'function') {
                                window.SimulationManager = {
                                    isReady: () => true,
                                    addSimulation: async (data) => {
                                        console.log('Adding simulation to fallback:', data);
                                        return { id: 'fallback-' + Date.now(), ...data };
                                    },
                                    getCustomSimulations: () => [],
                                    getStatistics: () => ({ total: 0, recentlyAdded: 0, totalAccess: 0 }),
                                    exportSimulations: () => ({ simulations: [] })
                                };
                            }
                            
                            if (!window.CollectionManager || typeof window.CollectionManager.isReady !== 'function') {
                                window.CollectionManager = {
                                    isReady: () => true,
                                    getCollections: () => [
                                        { id: 'default-physics', name: 'V·∫≠t l√Ω', icon: 'üî¨', description: 'Th√≠ nghi·ªám V·∫≠t l√Ω' },
                                        { id: 'default-chemistry', name: 'H√≥a h·ªçc', icon: 'üß™', description: 'Th√≠ nghi·ªám H√≥a h·ªçc' },
                                        { id: 'default-biology', name: 'Sinh h·ªçc', icon: 'üå±', description: 'Th√≠ nghi·ªám Sinh h·ªçc' },
                                        { id: 'default-mathematics', name: 'To√°n h·ªçc', icon: 'üìä', description: 'Th√≠ nghi·ªám To√°n h·ªçc' }
                                    ],
                                    getStatistics: () => ({ total: 4 })
                                };
                            }
                            
                            resolve();
                        } else {
                            setTimeout(checkAndCreate, 200);
                        }
                    };
                    
                    checkAndCreate();
                });
            }

            /**
             * Wait for simulation management dependencies
             */
            async function waitForSimulationManagers() {
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 50; // 5 seconds timeout
                    
                    const checkManagers = () => {
                        attempts++;
                        
                        if (attempts <= 5) {
                            console.log(`Attempt ${attempts}: Checking managers...`);
                        }
                        
                        const simulationManagerReady = window.SimulationManager && 
                            typeof window.SimulationManager.isReady === 'function' && 
                            window.SimulationManager.isReady();
                            
                        const collectionManagerReady = window.CollectionManager && 
                            typeof window.CollectionManager.isReady === 'function' && 
                            window.CollectionManager.isReady();
                            
                        if (attempts <= 5) {
                            console.log('SimulationManager ready:', simulationManagerReady);
                            console.log('CollectionManager ready:', collectionManagerReady);
                        }
                            
                        if (simulationManagerReady && collectionManagerReady) {
                            console.log('‚úÖ Both managers ready!');
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            console.error('‚ùå Managers not ready after timeout');
                            console.error('SimulationManager status:', {
                                exists: !!window.SimulationManager,
                                type: typeof window.SimulationManager,
                                hasIsReady: typeof window.SimulationManager?.isReady,
                                ready: window.SimulationManager?.isReady?.()
                            });
                            console.error('CollectionManager status:', {
                                exists: !!window.CollectionManager,
                                type: typeof window.CollectionManager,
                                hasIsReady: typeof window.CollectionManager?.isReady,
                                ready: window.CollectionManager?.isReady?.()
                            });
                            reject(new Error('Simulation managers not ready after timeout'));
                        } else {
                            setTimeout(checkManagers, 100);
                        }
                    };
                    
                    checkManagers();
                });
            }

            // Initialize page
            async function initializeTeacherTools() {
                try {
                    console.log('Initializing teacher tools...');

                    // Wait for dependencies
                    await waitForDependencies();

                    // Load simulations data - get all simulations from all subjects
                    const data = await window.DataManager.loadSimulations();
                    allSimulations = data.simulations || [];
                    filteredSimulations = [...allSimulations];

                    console.log('Loaded simulations:', allSimulations.length);
                    console.log('Sample simulation:', allSimulations[0]);

                    // Render simulation list
                    renderSimulationList();

                    // Wait for simulation management dependencies (non-blocking)
                    setTimeout(() => {
                        waitForSimulationManagers().then(() => {
                            console.log('‚úÖ Simulation managers ready');
                        }).catch(error => {
                            console.warn('‚ö†Ô∏è Simulation managers not available:', error);
                        });
                    }, 1000); // Wait 1 second for scripts to load

                    // Render teacher session info
                    if (window.TeacherAuth) {
                        window.TeacherAuth.renderLogoutButton('teacher-session-container');
                    }

                    console.log('Teacher tools initialized successfully');

                } catch (error) {
                    console.error('Failed to initialize teacher tools:', error);
                    showError('C√≥ l·ªói x·∫£y ra khi t·∫£i c√¥ng c·ª• gi√°o vi√™n: ' + error.message);
                }
            }

            async function waitForDependencies() {
                let attempts = 0;
                const maxAttempts = 50;

                return new Promise((resolve) => {
                    function checkDependencies() {
                        if (window.DataManager && 
                            typeof window.DataManager.getSimulationsBySubject === 'function' &&
                            window.TeacherCustomization &&
                            window.InstructionEditor) {
                            resolve();
                        } else if (attempts < maxAttempts) {
                            attempts++;
                            setTimeout(checkDependencies, 100);
                        } else {
                            console.warn('Dependencies not fully loaded, proceeding anyway');
                            resolve();
                        }
                    }
                    checkDependencies();
                });
            }

            function renderSimulationList() {
                const listContainer = document.getElementById('simulation-list');
                
                console.log('Rendering simulation list with', filteredSimulations.length, 'items');
                
                if (!listContainer) {
                    console.error('simulation-list container not found!');
                    return;
                }
                
                if (filteredSimulations.length === 0) {
                    listContainer.innerHTML = `
                        <div class="empty-state">
                            <p>Kh√¥ng t√¨m th·∫•y th√≠ nghi·ªám ph√π h·ª£p</p>
                            <p style="font-size: 14px; color: #666; margin-top: 8px;">
                                H√£y th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c ho·∫∑c thay ƒë·ªïi b·ªô l·ªçc m√¥n h·ªçc
                            </p>
                        </div>
                    `;
                    return;
                }

                const simulationItems = filteredSimulations.map(sim => {
                    const hasCustomization = window.TeacherCustomization ? 
                        window.TeacherCustomization.hasCustomization(sim.id) : false;
                    
                    return `
                        <div class="simulation-item ${hasCustomization ? 'customized' : ''}" 
                             role="listitem" 
                             data-simulation-id="${sim.id}"
                             onclick="selectSimulation('${sim.id}')">
                            
                            <div class="simulation-item-content">
                                <h4 class="simulation-item-title">${escapeHTML(sim.title)}</h4>
                                <p class="simulation-item-meta">
                                    ${getSubjectName(sim.subject)} ‚Ä¢ ${getDifficultyName(sim.difficulty)} ‚Ä¢ ${sim.gradeLevel}
                                </p>
                                <p class="simulation-item-description">${escapeHTML(sim.description)}</p>
                            </div>
                            
                            <div class="simulation-item-actions">
                                ${hasCustomization ? 
                                    '<span class="customization-badge">‚úèÔ∏è ƒê√£ t√πy ch·ªânh</span>' : 
                                    '<span class="customization-badge empty">‚ûï T√πy ch·ªânh</span>'
                                }
                            </div>
                        </div>
                    `;
                }).join('');

                listContainer.innerHTML = simulationItems;
            }

            function filterSimulations() {
                const selectedSubject = document.getElementById('subject-select').value;
                const searchTerm = document.getElementById('simulation-search').value.toLowerCase().trim();

                console.log('Filtering with subject:', selectedSubject, 'search:', searchTerm);
                console.log('Total simulations before filter:', allSimulations.length);

                filteredSimulations = allSimulations.filter(sim => {
                    const matchesSubject = !selectedSubject || sim.subject === selectedSubject;
                    
                    let matchesSearch = !searchTerm;
                    
                    if (searchTerm) {
                        // T√¨m ki·∫øm trong ti√™u ƒë·ªÅ, m√¥ t·∫£, ch·ªß ƒë·ªÅ, v√† m·ª•c ti√™u h·ªçc t·∫≠p
                        matchesSearch = 
                            sim.title.toLowerCase().includes(searchTerm) ||
                            sim.description.toLowerCase().includes(searchTerm) ||
                            (sim.topics && sim.topics.some(topic => topic.toLowerCase().includes(searchTerm))) ||
                            (sim.learningObjectives && sim.learningObjectives.some(obj => obj.toLowerCase().includes(searchTerm))) ||
                            (sim.tags && sim.tags.some(tag => tag.toLowerCase().includes(searchTerm)));
                        
                        // T√¨m ki·∫øm theo t·ª´ kh√≥a ti·∫øng Vi·ªát th√¥ng d·ª•ng
                        if (!matchesSearch) {
                            const searchKeywords = {
                                'luc': ['force', 'forces'],
                                'van toc': ['velocity', 'speed'],
                                'chuyen dong': ['motion'],
                                'dien': ['electric', 'electricity'],
                                'anh sang': ['light'],
                                'song': ['wave'],
                                'nhiet': ['heat', 'thermal'],
                                'than': ['gravity'],
                                'nam cham': ['magnet'],
                                'hoa hoc': ['chemistry', 'chemical'],
                                'phan ung': ['reaction'],
                                'acid': ['acid'],
                                'toan': ['math'],
                                'do thi': ['graph']
                            };
                            
                            for (const [vietnamese, englishTerms] of Object.entries(searchKeywords)) {
                                if (searchTerm.includes(vietnamese)) {
                                    matchesSearch = englishTerms.some(term => 
                                        sim.title.toLowerCase().includes(term) ||
                                        sim.description.toLowerCase().includes(term) ||
                                        (sim.topics && sim.topics.some(topic => topic.toLowerCase().includes(term)))
                                    );
                                    if (matchesSearch) break;
                                }
                            }
                        }
                    }
                    
                    const matches = matchesSubject && matchesSearch;
                    
                    if (searchTerm && matches) {
                        console.log('Found match:', sim.title);
                    }
                    
                    return matches;
                });

                console.log('Filtered simulations:', filteredSimulations.length);
                
                // Update search status
                updateSearchStatus(selectedSubject, searchTerm, filteredSimulations.length, allSimulations.length);
                
                renderSimulationList();
            }

            function searchSimulations() {
                filterSimulations();
            }

            function updateSearchStatus(selectedSubject, searchTerm, filteredCount, totalCount) {
                const statusDiv = document.getElementById('search-status');
                if (!statusDiv) return;

                if (!selectedSubject && !searchTerm) {
                    // No filters applied
                    statusDiv.style.display = 'none';
                    return;
                }

                let statusText = '';
                if (searchTerm && selectedSubject) {
                    statusText = `Hi·ªÉn th·ªã ${filteredCount}/${totalCount} th√≠ nghi·ªám v·ªõi t·ª´ kh√≥a "${searchTerm}" trong m√¥n ${getSubjectName(selectedSubject)}`;
                } else if (searchTerm) {
                    statusText = `Hi·ªÉn th·ªã ${filteredCount}/${totalCount} th√≠ nghi·ªám v·ªõi t·ª´ kh√≥a "${searchTerm}"`;
                } else if (selectedSubject) {
                    statusText = `Hi·ªÉn th·ªã ${filteredCount}/${totalCount} th√≠ nghi·ªám m√¥n ${getSubjectName(selectedSubject)}`;
                }

                if (filteredCount === 0) {
                    statusDiv.style.background = '#fef2f2';
                    statusDiv.style.borderColor = '#fecaca';
                    statusDiv.style.color = '#dc2626';
                    statusText = '‚ùå ' + statusText.replace('Hi·ªÉn th·ªã', 'Kh√¥ng t√¨m th·∫•y');
                } else {
                    statusDiv.style.background = '#f0f9ff';
                    statusDiv.style.borderColor = '#bae6fd';
                    statusDiv.style.color = '#0369a1';
                    statusText = '‚úÖ ' + statusText;
                }

                statusDiv.textContent = statusText;
                statusDiv.style.display = 'block';
            }

            function selectSimulation(simulationId) {
                const simulation = allSimulations.find(sim => sim.id === simulationId);
                if (!simulation) return;

                currentSimulation = simulation;
                showEditor(simulation);
            }

            function showEditor(simulation) {
                const editor = document.getElementById('customization-editor');
                const simulationInfo = document.getElementById('simulation-info');

                // Populate simulation info
                simulationInfo.innerHTML = `
                    <div class="simulation-info-content">
                        <h4>${escapeHTML(simulation.title)}</h4>
                        <p class="simulation-meta">
                            ${getSubjectName(simulation.subject)} ‚Ä¢ ${getDifficultyName(simulation.difficulty)} ‚Ä¢ ${simulation.gradeLevel}
                        </p>
                        <p class="simulation-description">${escapeHTML(simulation.description)}</p>
                    </div>
                `;

                // Load existing customizations
                if (window.TeacherCustomization) {
                    const customization = window.TeacherCustomization.getCustomization(simulation.id);
                    
                    document.getElementById('custom-objectives').value = customization.objectives || '';
                    document.getElementById('custom-instructions').value = customization.instructions || '';
                    
                    // Update preview
                    updatePreview();
                }

                // Show editor
                editor.style.display = 'block';
                editor.scrollIntoView({ behavior: 'smooth' });
            }

            function closeEditor() {
                const editor = document.getElementById('customization-editor');
                editor.style.display = 'none';
                currentSimulation = null;
                
                // Refresh simulation list to show updated customization status
                renderSimulationList();
                updateStatistics();
            }

            function updatePreview() {
                if (!window.InstructionEditor) return;

                const objectives = document.getElementById('custom-objectives').value;
                const instructions = document.getElementById('custom-instructions').value;

                const objectivesPreview = document.getElementById('objectives-preview');
                const instructionsPreview = document.getElementById('instructions-preview');

                if (objectives.trim()) {
                    objectivesPreview.innerHTML = window.InstructionEditor.markdownToHTML(objectives);
                } else {
                    objectivesPreview.innerHTML = '<em>Ch∆∞a c√≥ m·ª•c ti√™u t√πy ch·ªânh</em>';
                }

                if (instructions.trim()) {
                    instructionsPreview.innerHTML = window.InstructionEditor.markdownToHTML(instructions);
                } else {
                    instructionsPreview.innerHTML = '<em>Ch∆∞a c√≥ h∆∞·ªõng d·∫´n t√πy ch·ªânh</em>';
                }
            }

            function saveCustomization() {
                if (!currentSimulation || !window.TeacherCustomization) return;

                const objectives = document.getElementById('custom-objectives').value;
                const instructions = document.getElementById('custom-instructions').value;

                window.TeacherCustomization.saveCustomization(currentSimulation.id, {
                    objectives: objectives.trim(),
                    instructions: instructions.trim(),
                    simulationTitle: currentSimulation.title
                });

                updatePreview();
            }

            function saveAndClose() {
                saveCustomization();
                closeEditor();
            }

            function clearCustomization() {
                if (!currentSimulation) return;

                if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ t√πy ch·ªânh cho th√≠ nghi·ªám n√†y?')) {
                    window.TeacherCustomization.clearCustomization(currentSimulation.id);
                    
                    // Clear form
                    document.getElementById('custom-objectives').value = '';
                    document.getElementById('custom-instructions').value = '';
                    updatePreview();
                }
            }

            function previewSimulation() {
                if (!currentSimulation) return;
                
                // Save current changes first
                saveCustomization();
                
                // Open simulation in new tab
                window.open(`simulation.html?id=${currentSimulation.id}`, '_blank');
            }

            function updateStatistics() {
                if (!window.TeacherCustomization) return;

                const stats = window.TeacherCustomization.getStatistics();
                
                document.getElementById('total-customizations').textContent = stats.totalCustomizations;
                document.getElementById('total-objectives').textContent = stats.totalObjectives;
                document.getElementById('total-instructions').textContent = stats.totalInstructions;
                
                const lastUpdatedEl = document.getElementById('last-updated');
                if (stats.lastUpdated) {
                    const date = new Date(stats.lastUpdated);
                    lastUpdatedEl.textContent = date.toLocaleDateString('vi-VN');
                } else {
                    lastUpdatedEl.textContent = 'Ch∆∞a c√≥';
                }
            }

            // Global functions for toolbar and actions
            window.formatText = function(textareaId, format) {
                if (window.InstructionEditor) {
                    window.InstructionEditor.formatText(textareaId, format);
                    updatePreview();
                    saveCustomization();
                }
            };

            // Clear search function
            window.clearSearch = function() {
                document.getElementById('simulation-search').value = '';
                document.getElementById('subject-select').value = '';
                filterSimulations();
            };

            window.filterSimulations = filterSimulations;
            window.searchSimulations = searchSimulations;
            window.selectSimulation = selectSimulation;
            window.closeEditor = closeEditor;
            window.saveAndClose = saveAndClose;
            window.clearCustomization = clearCustomization;
            window.previewSimulation = previewSimulation;

            // Import/Export functions
            window.exportCustomizations = function() {
                if (window.TeacherCustomization) {
                    window.TeacherCustomization.exportCustomizations();
                }
            };

            window.importCustomizations = function() {
                if (window.TeacherCustomization) {
                    window.TeacherCustomization.importCustomizations();
                }
            };

            window.resetAllCustomizations = function() {
                if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a T·∫§T C·∫¢ t√πy ch·ªânh? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) {
                    if (window.TeacherCustomization) {
                        window.TeacherCustomization.resetAll();
                        renderSimulationList();
                        updateStatistics();
                        closeEditor();
                    }
                }
            };

            // Utility functions
            function getSubjectName(subject) {
                const subjects = {
                    physics: 'V·∫≠t l√Ω',
                    chemistry: 'H√≥a h·ªçc', 
                    biology: 'Sinh h·ªçc',
                    mathematics: 'To√°n h·ªçc'
                };
                return subjects[subject] || subject;
            }

            function getDifficultyName(difficulty) {
                const difficulties = {
                    beginner: 'C∆° b·∫£n',
                    intermediate: 'Trung b√¨nh',
                    advanced: 'N√¢ng cao'
                };
                return difficulties[difficulty] || difficulty;
            }

            function escapeHTML(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            function showError(message) {
                const listContainer = document.getElementById('simulation-list');
                listContainer.innerHTML = `
                    <div class="error-state">
                        <h3>C√≥ l·ªói x·∫£y ra</h3>
                        <p>${escapeHTML(message)}</p>
                        <button onclick="location.reload()" class="retry-btn">Th·ª≠ l·∫°i</button>
                    </div>
                `;
            }

            // ========================================
            // Tab Navigation Functions
            // ========================================

            async function switchTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.getElementById(`tab-${tabName}`).classList.add('active');
                
                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}-tab`).classList.add('active');
                
                // Initialize appropriate content
                if (tabName === 'management') {
                    await initializeSimulationManagement();
                }
            }

            // ========================================
            // Simulation Management Functions
            // ========================================

            async function initializeSimulationManagement() {
                console.log('Initializing simulation management...');
                
                // Force create managers if they don't exist or aren't ready
                await ensureManagersExist();
                
                // Try to wait for managers if they're not ready
                try {
                    await waitForSimulationManagers();
                } catch (error) {
                    console.warn('Continuing without simulation managers:', error);
                }
                
                loadCollections();
                updateStatistics();
                refreshCustomSimulations();
            }

            function toggleAddForm() {
                const form = document.getElementById('add-simulation-form');
                const isVisible = form.style.display !== 'none';
                
                if (isVisible) {
                    // Hide form
                    hideAddForm();
                } else {
                    // Show form
                    showAddForm();
                }
            }

            function showAddForm() {
                const form = document.getElementById('add-simulation-form');
                form.style.display = 'block';
                
                // Reset form when showing
                document.getElementById('simulation-form').reset();
                clearValidation();
                clearPreview();
                loadCollections();
                
                // Add ESC key listener
                document.addEventListener('keydown', handleEscapeKey);
                
                // Focus on first input
                const firstInput = form.querySelector('input[type="url"]');
                if (firstInput) {
                    firstInput.focus();
                }
                
                // Add overlay to close form when clicking outside
                addFormOverlay();
            }

            function hideAddForm() {
                const form = document.getElementById('add-simulation-form');
                form.style.display = 'none';
                
                // Remove ESC key listener
                document.removeEventListener('keydown', handleEscapeKey);
                
                // Remove overlay
                removeFormOverlay();
            }

            function handleEscapeKey(event) {
                if (event.key === 'Escape') {
                    event.preventDefault();
                    hideAddForm();
                }
            }

            function addFormOverlay() {
                // Remove existing overlay if any
                removeFormOverlay();
                
                const overlay = document.createElement('div');
                overlay.id = 'form-overlay';
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 999;
                    backdrop-filter: blur(2px);
                `;
                
                // Close form when clicking overlay
                overlay.addEventListener('click', hideAddForm);
                
                document.body.appendChild(overlay);
                
                // Make form appear above overlay
                const form = document.getElementById('add-simulation-form');
                form.style.position = 'relative';
                form.style.zIndex = '1000';
            }

            function removeFormOverlay() {
                const overlay = document.getElementById('form-overlay');
                if (overlay) {
                    overlay.remove();
                }
                
                // Reset form z-index
                const form = document.getElementById('add-simulation-form');
                if (form) {
                    form.style.position = '';
                    form.style.zIndex = '';
                }
            }

            function cancelAddForm() {
                hideAddForm();
            }

            async function validatePhETURL() {
                const urlInput = document.getElementById('phet-url');
                const validationDiv = document.getElementById('url-validation');
                const url = urlInput.value.trim();
                
                if (!url) {
                    validationDiv.style.display = 'none';
                    return;
                }
                
                validationDiv.style.display = 'block';
                validationDiv.className = 'url-validation validating';
                document.getElementById('validation-icon').textContent = '‚è≥';
                document.getElementById('validation-text').textContent = 'ƒêang ki·ªÉm tra URL...';
                
                try {
                    const result = await window.URLValidator.validatePhETURL(url);
                    
                    if (result.isValid) {
                        validationDiv.className = 'url-validation valid';
                        document.getElementById('validation-icon').textContent = '‚úÖ';
                        document.getElementById('validation-text').textContent = result.message;
                        
                        // Show metadata
                        if (result.metadata) {
                            displayMetadata(result.metadata);
                            
                            // Auto-fill title suggestions
                            const titleInput = document.getElementById('sim-title');
                            if (!titleInput.value && result.metadata.simulationName) {
                                const suggestions = window.URLValidator.generateVietnameseTitles(result.metadata.simulationName);
                                if (suggestions.length > 0) {
                                    titleInput.value = suggestions[0];
                                }
                            }
                        }
                        
                        // Auto-preview
                        setTimeout(() => previewSimulation(), 1000);
                        
                    } else {
                        validationDiv.className = 'url-validation invalid';
                        document.getElementById('validation-icon').textContent = '‚ùå';
                        document.getElementById('validation-text').textContent = result.message;
                        
                        if (result.suggestion) {
                            document.getElementById('validation-suggestion').textContent = result.suggestion;
                        }
                    }
                    
                } catch (error) {
                    validationDiv.className = 'url-validation invalid';
                    document.getElementById('validation-icon').textContent = '‚ùå';
                    document.getElementById('validation-text').textContent = 'C√≥ l·ªói x·∫£y ra khi ki·ªÉm tra URL';
                    console.error('URL validation error:', error);
                }
            }

            function displayMetadata(metadata) {
                const metadataDiv = document.getElementById('url-metadata');
                metadataDiv.style.display = 'block';
                metadataDiv.innerHTML = `
                    <div class="metadata-item">
                        <span class="metadata-label">T√™n th√≠ nghi·ªám:</span>
                        <span class="metadata-value">${metadata.simulationName || 'N/A'}</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">Ng√¥n ng·ªØ:</span>
                        <span class="metadata-value">${metadata.language === 'vi' ? 'Ti·∫øng Vi·ªát' : 'Ti·∫øng Anh'}</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">Lo·∫°i:</span>
                        <span class="metadata-value">${metadata.isHTML5 ? 'HTML5' : 'Flash'}</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">Phi√™n b·∫£n:</span>
                        <span class="metadata-value">${metadata.isLatest ? 'M·ªõi nh·∫•t' : 'C≈©'}</span>
                    </div>
                `;
            }

            function clearValidation() {
                const validationDiv = document.getElementById('url-validation');
                validationDiv.style.display = 'none';
                document.getElementById('url-metadata').style.display = 'none';
                document.getElementById('validation-suggestion').textContent = '';
            }

            async function previewSimulation() {
                const urlInput = document.getElementById('phet-url');
                const previewContainer = document.getElementById('preview-container');
                const url = urlInput.value.trim();
                
                if (!url) {
                    previewContainer.innerHTML = '<div class="preview-placeholder">Nh·∫≠p URL h·ª£p l·ªá ƒë·ªÉ xem tr∆∞·ªõc th√≠ nghi·ªám</div>';
                    return;
                }
                
                try {
                    const result = await window.URLValidator.previewSimulation(url, previewContainer);
                    
                    if (!result.success) {
                        previewContainer.innerHTML = `<div class="preview-error">${result.message}</div>`;
                    }
                    
                } catch (error) {
                    console.error('Preview error:', error);
                    previewContainer.innerHTML = '<div class="preview-error">Kh√¥ng th·ªÉ t·∫£i xem tr∆∞·ªõc th√≠ nghi·ªám</div>';
                }
            }

            function clearPreview() {
                const previewContainer = document.getElementById('preview-container');
                previewContainer.innerHTML = '<div class="preview-placeholder">Nh·∫≠p URL h·ª£p l·ªá ƒë·ªÉ xem tr∆∞·ªõc th√≠ nghi·ªám</div>';
            }

            function addTag(event) {
                if (event.key === 'Enter' || event.key === ',') {
                    event.preventDefault();
                    const input = event.target;
                    const tag = input.value.trim();
                    
                    if (tag && tag !== ',') {
                        const tagsContainer = document.getElementById('tags-container');
                        const tagElement = document.createElement('div');
                        tagElement.className = 'tag-item';
                        tagElement.innerHTML = `
                            ${escapeHTML(tag)}
                            <button type="button" class="tag-remove" onclick="removeTag(this)">√ó</button>
                        `;
                        
                        tagsContainer.insertBefore(tagElement, input);
                        input.value = '';
                        updateTagsInput();
                    }
                }
            }

            function removeTag(button) {
                button.parentElement.remove();
                updateTagsInput();
            }

            function updateTagsInput() {
                const tags = Array.from(document.querySelectorAll('.tag-item'))
                    .map(tag => tag.textContent.replace('√ó', '').trim())
                    .filter(tag => tag);
                document.getElementById('sim-tags').value = JSON.stringify(tags);
            }

            function loadCollections() {
                const collectionsContainer = document.getElementById('collections-selection');
                
                if (!collectionsContainer) {
                    console.warn('Collections container not found');
                    return;
                }
                
                if (window.CollectionManager && 
                    typeof window.CollectionManager.isReady === 'function' && 
                    window.CollectionManager.isReady()) {
                    
                    try {
                        const collections = window.CollectionManager.getCollections();
                        collectionsContainer.innerHTML = collections.map(collection => `
                            <div class="collection-card" onclick="toggleCollection('${collection.id}')">
                                <div class="collection-icon">${collection.icon || 'üìÇ'}</div>
                                <div class="collection-name">${collection.name}</div>
                                <div class="collection-description">${collection.description || ''}</div>
                                <input type="checkbox" name="selectedCollections" value="${collection.id}" style="display: none;">
                            </div>
                        `).join('');
                    } catch (error) {
                        console.warn('Error loading collections:', error);
                        collectionsContainer.innerHTML = '<p>L·ªói khi t·∫£i b·ªô s∆∞u t·∫≠p</p>';
                    }
                } else {
                    collectionsContainer.innerHTML = '<p>ƒêang t·∫£i b·ªô s∆∞u t·∫≠p...</p>';
                }
            }

            function toggleCollection(collectionId) {
                const card = event.currentTarget;
                const checkbox = card.querySelector('input[type="checkbox"]');
                
                checkbox.checked = !checkbox.checked;
                card.classList.toggle('selected', checkbox.checked);
                
                updateCollectionsInput();
            }

            function updateCollectionsInput() {
                const selectedCollections = Array.from(document.querySelectorAll('input[name="selectedCollections"]:checked'))
                    .map(cb => cb.value);
                document.getElementById('sim-collections').value = JSON.stringify(selectedCollections);
            }

            async function addCustomSimulation(event) {
                event.preventDefault();
                
                const formData = new FormData(event.target);
                const submitBtn = document.getElementById('submit-btn');
                const originalText = submitBtn.innerHTML;
                
                try {
                    submitBtn.innerHTML = '‚è≥ ƒêang th√™m...';
                    submitBtn.disabled = true;
                    
                    // Collect grade levels
                    const gradeLevels = Array.from(document.querySelectorAll('input[name="gradeLevel"]:checked'))
                        .map(cb => parseInt(cb.value));
                    
                    if (gradeLevels.length === 0) {
                        throw new Error('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt c·∫•p l·ªõp');
                    }
                    
                    // Collect tags
                    const tags = JSON.parse(document.getElementById('sim-tags').value || '[]');
                    
                    // Collect collections
                    const collections = JSON.parse(document.getElementById('sim-collections').value || '[]');
                    
                    // Parse topics
                    const topics = formData.get('topics')
                        ? formData.get('topics').split(',').map(topic => topic.trim()).filter(topic => topic)
                        : [];
                    
                    const simulationData = {
                        title: formData.get('title'),
                        description: formData.get('description'),
                        phetUrl: formData.get('phetUrl'),
                        subject: formData.get('subject'),
                        gradeLevel: gradeLevels,
                        difficulty: formData.get('difficulty') || 'intermediate',
                        duration: parseInt(formData.get('duration')) || 30,
                        topics: topics,
                        learningObjectives: formData.get('learningObjectives') || '',
                        tags: tags,
                        collections: collections,
                        thumbnailUrl: '', // Could be extracted from PhET if available
                        isCustom: true
                    };
                    
                    // Add simulation
                    const result = await window.SimulationManager.addSimulation(simulationData);
                    
                    // Success
                    showMessage('‚úÖ Th√≠ nghi·ªám ƒë√£ ƒë∆∞·ª£c th√™m th√†nh c√¥ng!', 'success');
                    hideAddForm();
                    refreshCustomSimulations();
                    updateStatistics();
                    
                } catch (error) {
                    console.error('Error adding simulation:', error);
                    showMessage('‚ùå C√≥ l·ªói x·∫£y ra: ' + error.message, 'error');
                } finally {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            }

            function updateStatistics() {
                // Safely update statistics only if managers are ready
                if (window.SimulationManager && 
                    typeof window.SimulationManager.isReady === 'function' && 
                    window.SimulationManager.isReady()) {
                    
                    try {
                        const stats = window.SimulationManager.getStatistics();
                        const totalElement = document.getElementById('total-custom-sims');
                        const recentElement = document.getElementById('recent-additions');
                        const accessElement = document.getElementById('total-access');
                        
                        if (totalElement) totalElement.textContent = stats.total;
                        if (recentElement) recentElement.textContent = stats.recentlyAdded;
                        if (accessElement) accessElement.textContent = stats.totalAccess;
                    } catch (error) {
                        console.warn('Error updating simulation statistics:', error);
                    }
                }
                
                if (window.CollectionManager && 
                    typeof window.CollectionManager.isReady === 'function' && 
                    window.CollectionManager.isReady()) {
                    
                    try {
                        const collectionsStats = window.CollectionManager.getStatistics();
                        const collectionsElement = document.getElementById('total-collections');
                        if (collectionsElement) collectionsElement.textContent = collectionsStats.total;
                    } catch (error) {
                        console.warn('Error updating collection statistics:', error);
                    }
                }
            }

            function refreshCustomSimulations() {
                const gridContainer = document.getElementById('custom-simulations-grid');
                
                if (!gridContainer) {
                    console.warn('Custom simulations grid container not found');
                    return;
                }
                
                if (window.SimulationManager && 
                    typeof window.SimulationManager.isReady === 'function' && 
                    window.SimulationManager.isReady()) {
                    const customSims = window.SimulationManager.getCustomSimulations();
                    
                    if (customSims.length === 0) {
                        gridContainer.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">üéØ</div>
                                <div class="empty-state-title">Ch∆∞a c√≥ th√≠ nghi·ªám t√πy ch·ªânh</div>
                                <div class="empty-state-description">
                                    Th√™m th√≠ nghi·ªám PhET t√πy ch·ªânh ƒë·ªÉ m·ªü r·ªông th∆∞ vi·ªán c·ªßa b·∫°n
                                </div>
                                <button type="button" class="btn-primary-large" onclick="toggleAddForm()">
                                    ‚ûï Th√™m th√≠ nghi·ªám ƒë·∫ßu ti√™n
                                </button>
                            </div>
                        `;
                    } else {
                        gridContainer.innerHTML = customSims.map(sim => `
                            <div class="simulation-item fade-in">
                                <div class="simulation-header">
                                    <div>
                                        <div class="simulation-title">${escapeHTML(sim.title)}</div>
                                        <div class="simulation-url">${escapeHTML(sim.phetUrl)}</div>
                                    </div>
                                    <div class="simulation-actions">
                                        <button class="btn-small btn-preview" onclick="previewCustomSimulation('${sim.id}')">
                                            üëÅÔ∏è Xem
                                        </button>
                                        <button class="btn-small btn-edit" onclick="editCustomSimulation('${sim.id}')">
                                            ‚úèÔ∏è S·ª≠a
                                        </button>
                                        <button class="btn-small btn-delete" onclick="deleteCustomSimulation('${sim.id}')">
                                            üóëÔ∏è X√≥a
                                        </button>
                                    </div>
                                </div>
                                <div class="simulation-meta">
                                    <span class="meta-item">${getSubjectName(sim.subject)}</span>
                                    <span class="meta-item">L·ªõp ${sim.gradeLevel.join(', ')}</span>
                                    <span class="meta-item">${getDifficultyName(sim.difficulty)}</span>
                                    <span class="meta-item">${sim.duration} ph√∫t</span>
                                </div>
                                <div class="simulation-description">${escapeHTML(sim.description)}</div>
                            </div>
                        `).join('');
                    }
                }
            }

            function showMessage(message, type) {
                // Remove existing messages
                document.querySelectorAll('.message').forEach(msg => msg.remove());
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                messageDiv.innerHTML = message;
                
                const form = document.getElementById('add-simulation-form');
                form.insertBefore(messageDiv, form.firstChild);
                
                // Auto-remove after 5 seconds
                setTimeout(() => messageDiv.remove(), 5000);
            }

            async function exportCustomSimulations() {
                try {
                    if (!window.SimulationManager || 
                        typeof window.SimulationManager.exportSimulations !== 'function') {
                        throw new Error('SimulationManager not available');
                    }
                    
                    const data = window.SimulationManager.exportSimulations();
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `edulab-custom-simulations-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    
                    URL.revokeObjectURL(url);
                    showMessage('‚úÖ D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c xu·∫•t th√†nh c√¥ng!', 'success');
                } catch (error) {
                    console.error('Export error:', error);
                    showMessage('‚ùå C√≥ l·ªói x·∫£y ra khi xu·∫•t d·ªØ li·ªáu: ' + error.message, 'error');
                }
            }

            function showImportDialog() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = importCustomSimulations;
                input.click();
            }

            async function importCustomSimulations(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    const result = await window.SimulationManager.importSimulations(data, true);
                    
                    let message = `‚úÖ Nh·∫≠p th√†nh c√¥ng ${result.imported} th√≠ nghi·ªám`;
                    if (result.skipped > 0) {
                        message += `, b·ªè qua ${result.skipped} th√≠ nghi·ªám ƒë√£ t·ªìn t·∫°i`;
                    }
                    if (result.errors.length > 0) {
                        message += `, ${result.errors.length} l·ªói`;
                    }
                    
                    showMessage(message, result.errors.length > 0 ? 'warning' : 'success');
                    refreshCustomSimulations();
                    updateStatistics();
                    
                } catch (error) {
                    console.error('Import error:', error);
                    showMessage('‚ùå C√≥ l·ªói x·∫£y ra khi nh·∫≠p d·ªØ li·ªáu: ' + error.message, 'error');
                }
            }

            // Expose functions globally for onclick handlers
            window.switchTab = (tabName) => {
                // Wrapper to handle async function in onclick
                switchTab(tabName).catch(error => {
                    console.error('Error switching tab:', error);
                });
            };
            window.toggleAddForm = toggleAddForm;
            window.showAddForm = showAddForm;
            window.hideAddForm = hideAddForm;
            window.cancelAddForm = cancelAddForm;
            window.validatePhETURL = validatePhETURL;
            window.previewSimulation = previewSimulation;
            window.addTag = addTag;
            window.removeTag = removeTag;
            window.toggleCollection = toggleCollection;
            window.addCustomSimulation = addCustomSimulation;
            window.refreshCustomSimulations = refreshCustomSimulations;
            window.exportCustomSimulations = exportCustomSimulations;
            window.showImportDialog = showImportDialog;
            
            // Debug helpers
            window.debugManagers = () => {
                console.log('=== MANAGER DEBUG ===');
                console.log('SimulationManager:', window.SimulationManager);
                console.log('CollectionManager:', window.CollectionManager);
                if (window.SimulationManager) {
                    console.log('SimulationManager.isReady:', typeof window.SimulationManager.isReady);
                    if (typeof window.SimulationManager.isReady === 'function') {
                        console.log('SimulationManager ready status:', window.SimulationManager.isReady());
                    }
                }
                if (window.CollectionManager) {
                    console.log('CollectionManager.isReady:', typeof window.CollectionManager.isReady);
                    if (typeof window.CollectionManager.isReady === 'function') {
                        console.log('CollectionManager ready status:', window.CollectionManager.isReady());
                    }
                }
                console.log('====================');
            };
            
            window.forceInitManagers = async () => {
                console.log('Force initializing managers...');
                await initializeSimulationManagement();
            };
            
            window.manualInitManagers = async () => {
                console.log('Manual manager initialization...');
                
                // Fix: Create instances from the classes
                if (window.SimulationManager && typeof window.SimulationManager === 'function') {
                    try {
                        console.log('Creating SimulationManager instance...');
                        console.log('SimulationManager before:', window.SimulationManager);
                        const manager = new window.SimulationManager();
                        console.log('Created manager instance:', manager);
                        await manager.initialize();
                        console.log('Manager initialized, isReady:', manager.isReady());
                        window.SimulationManager = manager; // Replace class with instance
                        console.log('‚úÖ SimulationManager instance created and initialized');
                        console.log('SimulationManager after:', window.SimulationManager);
                    } catch (error) {
                        console.error('‚ùå SimulationManager initialization failed:', error);
                        console.error('Error details:', error.stack);
                    }
                }
                
                if (window.CollectionManager && typeof window.CollectionManager === 'function') {
                    try {
                        console.log('Creating CollectionManager instance...');
                        console.log('CollectionManager before:', window.CollectionManager);
                        const manager = new window.CollectionManager();
                        console.log('Created manager instance:', manager);
                        await manager.initialize();
                        console.log('Manager initialized, isReady:', manager.isReady());
                        window.CollectionManager = manager; // Replace class with instance
                        console.log('‚úÖ CollectionManager instance created and initialized');
                        console.log('CollectionManager after:', window.CollectionManager);
                    } catch (error) {
                        console.error('‚ùå CollectionManager initialization failed:', error);
                        console.error('Error details:', error.stack);
                    }
                }
                
                console.log('Manual initialization complete');
                checkScripts();
            };
            
            window.checkScripts = () => {
                console.log('=== SCRIPT STATUS ===');
                console.log('SimulationManager in window:', !!window.SimulationManager);
                console.log('CollectionManager in window:', !!window.CollectionManager);
                console.log('URLValidator in window:', !!window.URLValidator);
                
                if (window.SimulationManager) {
                    console.log('SimulationManager type:', typeof window.SimulationManager);
                    console.log('SimulationManager.isReady:', typeof window.SimulationManager.isReady);
                    if (typeof window.SimulationManager.isReady === 'function') {
                        console.log('SimulationManager ready status:', window.SimulationManager.isReady());
                    }
                    console.log('SimulationManager methods:', Object.keys(window.SimulationManager));
                }
                
                if (window.CollectionManager) {
                    console.log('CollectionManager type:', typeof window.CollectionManager);
                    console.log('CollectionManager.isReady:', typeof window.CollectionManager.isReady);
                    if (typeof window.CollectionManager.isReady === 'function') {
                        console.log('CollectionManager ready status:', window.CollectionManager.isReady());
                    }
                    console.log('CollectionManager methods:', Object.keys(window.CollectionManager));
                }
                
                console.log('====================');
            };
            
            // Create working test managers for immediate use
            window.createTestManagers = () => {
                console.log('Creating test managers...');
                
                window.SimulationManager = {
                    isReady: () => true,
                    addSimulation: async (data) => {
                        console.log('Test: Adding simulation:', data);
                        
                        // Save to localStorage
                        const stored = JSON.parse(localStorage.getItem('edulab_test_simulations') || '[]');
                        const newSim = {
                            ...data,
                            id: 'test-' + Date.now(),
                            addedDate: new Date().toISOString(),
                            isCustom: true
                        };
                        stored.push(newSim);
                        localStorage.setItem('edulab_test_simulations', JSON.stringify(stored));
                        
                        console.log('‚úÖ Simulation saved to localStorage');
                        return newSim;
                    },
                    getCustomSimulations: () => {
                        return JSON.parse(localStorage.getItem('edulab_test_simulations') || '[]');
                    },
                    getStatistics: () => {
                        const sims = JSON.parse(localStorage.getItem('edulab_test_simulations') || '[]');
                        return {
                            total: sims.length,
                            recentlyAdded: sims.filter(s => {
                                const added = new Date(s.addedDate);
                                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                                return added > weekAgo;
                            }).length,
                            totalAccess: 0
                        };
                    },
                    exportSimulations: () => {
                        const sims = JSON.parse(localStorage.getItem('edulab_test_simulations') || '[]');
                        return {
                            version: '1.0',
                            exportDate: new Date().toISOString(),
                            simulations: sims
                        };
                    }
                };
                
                window.CollectionManager = {
                    isReady: () => true,
                    getCollections: () => [
                        { id: 'default-physics', name: 'V·∫≠t l√Ω', icon: 'üî¨', description: 'Th√≠ nghi·ªám V·∫≠t l√Ω' },
                        { id: 'default-chemistry', name: 'H√≥a h·ªçc', icon: 'üß™', description: 'Th√≠ nghi·ªám H√≥a h·ªçc' },
                        { id: 'default-biology', name: 'Sinh h·ªçc', icon: 'üå±', description: 'Th√≠ nghi·ªám Sinh h·ªçc' },
                        { id: 'default-mathematics', name: 'To√°n h·ªçc', icon: 'üìä', description: 'Th√≠ nghi·ªám To√°n h·ªçc' }
                    ],
                    getStatistics: () => ({ total: 4 })
                };
                
                console.log('‚úÖ Test managers created and ready!');
                checkScripts();
            };

            // Auto-check scripts status after a delay
            setTimeout(() => {
                console.log('üîç Auto-checking scripts after 2 seconds...');
                if (window.checkScripts) window.checkScripts();
            }, 2000);

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeTeacherTools);
            } else {
                initializeTeacherTools();
            }

        })();
    </script>

</body>
</html>
