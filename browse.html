<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Duy·ªát th∆∞ vi·ªán th√≠ nghi·ªám PhET Interactive Simulations c·ªßa EduLab - T√¨m ki·∫øm v√† l·ªçc th√≠ nghi·ªám theo m√¥n h·ªçc v√† c·∫•p ƒë·ªô">
    <meta name="keywords" content="th√≠ nghi·ªám ·∫£o, PhET, duy·ªát th√≠ nghi·ªám, t√¨m ki·∫øm, l·ªçc theo m√¥n h·ªçc">
    <meta name="author" content="EduLab">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Th∆∞ vi·ªán Th√≠ nghi·ªám - EduLab">
    <meta property="og:description" content="Duy·ªát v√† t√¨m ki·∫øm th√≠ nghi·ªám PhET Interactive Simulations">
    
    <title>Th∆∞ vi·ªán Th√≠ nghi·ªám - EduLab</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/simulation-embed.css">
    <link rel="stylesheet" href="css/simulation-library.css">
    <link rel="stylesheet" href="css/completion-status.css">
    <link rel="stylesheet" href="css/loading-states.css">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://phet.colorado.edu">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#library-content" class="skip-link">Chuy·ªÉn ƒë·∫øn th∆∞ vi·ªán th√≠ nghi·ªám</a>
    
    <!-- Header -->
    <header class="header" role="banner">
        <nav class="nav" role="navigation" aria-label="ƒêi·ªÅu h∆∞·ªõng ch√≠nh">
            <div class="nav-container">
                <div class="nav-brand">
                    <h1 class="logo">
                        <a href="index.html" style="color: inherit; text-decoration: none;">
                            <span class="logo-icon" aria-hidden="true">üß™</span>
                            EduLab
                        </a>
                    </h1>
                    <p class="tagline">Th∆∞ vi·ªán Th√≠ nghi·ªám</p>
                </div>
                
                <!-- Mobile menu button -->
                <button class="nav-toggle" aria-expanded="false" aria-controls="nav-menu" aria-label="M·ªü menu ƒëi·ªÅu h∆∞·ªõng">
                    <span class="hamburger"></span>
                    <span class="hamburger"></span>
                    <span class="hamburger"></span>
                </button>
                
                <!-- Navigation menu -->
                <ul class="nav-menu" id="nav-menu" role="menubar">
                    <li role="none">
                        <a href="index.html" class="nav-link" role="menuitem">‚Üê Trang ch·ªß</a>
                    </li>
                    <li role="none">
                        <a href="#library-content" class="nav-link active" role="menuitem" aria-current="page">Th∆∞ vi·ªán</a>
                    </li>
                    <li role="none">
                        <a href="teacher-login.html" class="nav-link" role="menuitem">üë®‚Äçüè´ C√¥ng c·ª• GV</a>
                    </li>
                    <li role="none">
                        <a href="index.html#about" class="nav-link" role="menuitem">Gi·ªõi thi·ªáu</a>
                    </li>
                    <li role="none">
                        <a href="#help" class="nav-link" role="menuitem">H∆∞·ªõng d·∫´n</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Main content -->
    <main id="library-content" class="main" role="main">
        <div class="library-container">
            
            <!-- Library header -->
            <div class="library-header">
                <h2 class="library-title">Th∆∞ vi·ªán Th√≠ nghi·ªám</h2>
                <p class="library-subtitle">
                    Kh√°m ph√° b·ªô s∆∞u t·∫≠p th√≠ nghi·ªám PhET Interactive Simulations ƒë∆∞·ª£c tuy·ªÉn ch·ªçn. 
                    S·ª≠ d·ª•ng b·ªô l·ªçc v√† t√¨m ki·∫øm ƒë·ªÉ t√¨m th√≠ nghi·ªám ph√π h·ª£p v·ªõi nhu c·∫ßu h·ªçc t·∫≠p.
                </p>
            </div>

            <!-- Progress statistics -->
            <div id="progress-stats-container" style="margin-bottom: var(--spacing-xl);">
                <!-- Progress stats will be rendered here -->
            </div>

            <!-- Search and filter bar -->
            <div class="filter-bar" role="search" aria-label="T√¨m ki·∫øm v√† l·ªçc th√≠ nghi·ªám">
                <div class="filter-row">
                    
                    <!-- Search input -->
                    <div class="search-container">
                        <div class="search-icon" aria-hidden="true">üîç</div>
                        <input type="search" 
                               id="search-input" 
                               class="search-input" 
                               placeholder="T√¨m ki·∫øm th√≠ nghi·ªám theo t√™n ho·∫∑c ch·ªß ƒë·ªÅ..."
                               aria-label="T√¨m ki·∫øm th√≠ nghi·ªám"
                               autocomplete="off">
                        <button id="search-clear" 
                                class="search-clear" 
                                aria-label="X√≥a t√¨m ki·∫øm"
                                title="X√≥a t√¨m ki·∫øm">‚úï</button>
                    </div>

                    <!-- Subject filter -->
                    <div class="filter-group">
                        <span class="filter-label">M√¥n h·ªçc:</span>
                        <div class="filter-buttons" id="subject-filters" role="group" aria-label="L·ªçc theo m√¥n h·ªçc">
                            <button class="filter-btn active" data-subject="physics" aria-pressed="true">
                                ‚öõÔ∏è V·∫≠t L√Ω
                            </button>
                            <button class="filter-btn" data-subject="chemistry" aria-pressed="false">
                                üß™ H√≥a H·ªçc
                            </button>
                            <button class="filter-btn" data-subject="biology" aria-pressed="false">
                                üî¨ Sinh H·ªçc
                            </button>
                            <button class="filter-btn" data-subject="mathematics" aria-pressed="false">
                                üìä To√°n H·ªçc
                            </button>
                        </div>
                    </div>

                    <!-- Grade level filter -->
                    <div class="filter-group">
                        <span class="filter-label">L·ªõp:</span>
                        <div class="filter-buttons" id="grade-filters" role="group" aria-label="L·ªçc theo c·∫•p l·ªõp">
                            <button class="filter-btn" data-grade="6-8" aria-pressed="false">
                                L·ªõp 6-8
                            </button>
                            <button class="filter-btn" data-grade="9-10" aria-pressed="false">
                                L·ªõp 9-10
                            </button>
                            <button class="filter-btn" data-grade="11-12" aria-pressed="false">
                                L·ªõp 11-12
                            </button>
                        </div>
                    </div>

                    <!-- Difficulty filter -->
                    <div class="filter-group">
                        <span class="filter-label">C·∫•p ƒë·ªô:</span>
                        <div class="filter-buttons" id="difficulty-filters" role="group" aria-label="L·ªçc theo ƒë·ªô kh√≥">
                            <button class="filter-btn" data-difficulty="beginner" aria-pressed="false">
                                C∆° b·∫£n
                            </button>
                            <button class="filter-btn" data-difficulty="intermediate" aria-pressed="false">
                                Trung b√¨nh
                            </button>
                            <button class="filter-btn" data-difficulty="advanced" aria-pressed="false">
                                N√¢ng cao
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Clear filters button -->
                <button id="clear-filters" 
                        class="empty-action" 
                        style="display: none; margin-top: var(--spacing-md);"
                        aria-label="X√≥a t·∫•t c·∫£ b·ªô l·ªçc">
                    X√≥a t·∫•t c·∫£ b·ªô l·ªçc
                </button>
            </div>

            <!-- Results header -->
            <div class="results-header">
                <div class="results-count" id="results-count" aria-live="polite" aria-atomic="true">
                    ƒêang t·∫£i...
                </div>
                
                <div class="results-sort">
                    <label for="sort-select" class="filter-label">S·∫Øp x·∫øp:</label>
                    <select id="sort-select" class="sort-dropdown" aria-label="S·∫Øp x·∫øp k·∫øt qu·∫£">
                        <option value="default">M·∫∑c ƒë·ªãnh</option>
                        <option value="title">T√™n A-Z</option>
                        <option value="difficulty">ƒê·ªô kh√≥</option>
                        <option value="grade">C·∫•p l·ªõp</option>
                    </select>
                </div>
            </div>

            <!-- Simulations grid -->
            <div class="simulations-grid" id="simulations-grid" role="region" aria-live="polite" aria-label="Danh s√°ch th√≠ nghi·ªám">
                <!-- Cards will be rendered here by JavaScript -->
                <div class="library-loading">
                    <div class="library-spinner"></div>
                    <div class="loading-text">ƒêang t·∫£i th∆∞ vi·ªán th√≠ nghi·ªám...</div>
                </div>
            </div>

            <!-- Help section -->
            <section class="help-section" id="help" style="margin-top: var(--spacing-3xl); padding: var(--spacing-2xl); background: var(--gray-50); border-radius: var(--radius-xl);">
                <h3 style="color: var(--primary-color); margin-bottom: var(--spacing-lg); text-align: center;">
                    üìñ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng
                </h3>
                
                <div style="display: grid; gap: var(--spacing-lg); grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                    <div class="help-item">
                        <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-sm);">üîç T√¨m ki·∫øm</h4>
                        <p style="color: var(--text-secondary); font-size: var(--font-size-sm);">
                            Nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ t√¨m th√≠ nghi·ªám theo t√™n ho·∫∑c ch·ªß ƒë·ªÅ. K·∫øt qu·∫£ s·∫Ω c·∫≠p nh·∫≠t t·ª± ƒë·ªông khi b·∫°n g√µ.
                        </p>
                    </div>
                    
                    <div class="help-item">
                        <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-sm);">üéØ L·ªçc</h4>
                        <p style="color: var(--text-secondary); font-size: var(--font-size-sm);">
                            S·ª≠ d·ª•ng c√°c b·ªô l·ªçc ƒë·ªÉ thu h·∫πp k·∫øt qu·∫£ theo m√¥n h·ªçc, c·∫•p l·ªõp ho·∫∑c ƒë·ªô kh√≥ ph√π h·ª£p.
                        </p>
                    </div>
                    
                    <div class="help-item">
                        <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-sm);">üëÜ T∆∞∆°ng t√°c</h4>
                        <p style="color: var(--text-secondary); font-size: var(--font-size-sm);">
                            Nh·∫•n v√†o th·∫ª th√≠ nghi·ªám ƒë·ªÉ xem chi ti·∫øt ho·∫∑c d√πng n√∫t "Xem tr∆∞·ªõc" ƒë·ªÉ xem th√¥ng tin nhanh.
                        </p>
                    </div>
                    
                    <div class="help-item">
                        <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-sm);">‚å®Ô∏è Ph√≠m t·∫Øt</h4>
                        <p style="color: var(--text-secondary); font-size: var(--font-size-sm);">
                            Nh·∫•n Ctrl+F ƒë·ªÉ t√¨m ki·∫øm nhanh, Tab ƒë·ªÉ ƒëi·ªÅu h∆∞·ªõng, Enter ƒë·ªÉ m·ªü th√≠ nghi·ªám.
                        </p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 class="footer-title">EduLab</h3>
                    <p class="footer-description">
                        N·ªÅn t·∫£ng th√≠ nghi·ªám ·∫£o mi·ªÖn ph√≠ cho gi√°o d·ª•c Vi·ªát Nam
                    </p>
                </div>
                
                <div class="footer-section">
                    <h4 class="footer-heading">Th∆∞ vi·ªán</h4>
                    <ul class="footer-links">
                        <li><a href="#" onclick="window.SimulationBrowserInstance?.setSubject('physics')">V·∫≠t L√Ω</a></li>
                        <li><a href="#" onclick="window.SimulationBrowserInstance?.setSubject('chemistry')">H√≥a H·ªçc</a></li>
                        <li><a href="#" onclick="window.SimulationBrowserInstance?.setSubject('biology')">Sinh H·ªçc</a></li>
                        <li><a href="#" onclick="window.SimulationBrowserInstance?.setSubject('mathematics')">To√°n H·ªçc</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4 class="footer-heading">Li√™n k·∫øt h·ªØu √≠ch</h4>
                    <ul class="footer-links">
                        <li><a href="https://phet.colorado.edu" target="_blank" rel="noopener">PhET Interactive Simulations</a></li>
                        <li><a href="index.html">Trang ch·ªß</a></li>
                        <li><a href="#help">H∆∞·ªõng d·∫´n</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4 class="footer-heading">H·ªó tr·ª£</h4>
                    <ul class="footer-links">
                        <li><a href="#feedback">G√≥p √Ω</a></li>
                        <li><a href="#accessibility">Tr·ª£ nƒÉng</a></li>
                        <li><a href="index.html#about">Gi·ªõi thi·ªáu</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 EduLab. D·ª± √°n m√£ ngu·ªìn m·ªü v√¨ gi√°o d·ª•c.</p>
                <p>ƒê∆∞·ª£c x√¢y d·ª±ng v·ªõi ‚ù§Ô∏è cho gi√°o d·ª•c Vi·ªát Nam</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="js/error-handler.js"></script>
    <script src="js/performance-optimizer.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/content-filter.js"></script>
    <script src="js/phet-integration.js"></script>
    <script src="js/simulation-loader.js"></script>
    <script src="js/completion-tracker.js"></script>
    <script src="js/progress-display.js"></script>
    <script src="js/card-renderer.js"></script>
    <script src="js/simulation-browser.js"></script>
    <script src="js/main.js"></script>
    
    <!-- Browse page specific script -->
    <script>
        (function() {
            'use strict';

            // Initialize browse page
            document.addEventListener('DOMContentLoaded', function() {
                initializeBrowsePage();
            });

            async function initializeBrowsePage() {
                try {
                    // Wait for dependencies
                    await waitForDependencies();
                    console.log('Dependencies loaded:', {
                        DataManager: !!window.DataManager,
                        ContentFilter: !!window.ContentFilter,
                        CardRenderer: !!window.CardRenderer,
                        SimulationBrowser: !!window.SimulationBrowser
                    });

                    // Initialize the simulation browser
                    if (window.SimulationBrowser) {
                        // Create a new browser instance
                        const filter = new window.ContentFilter(window.DataManager);
                        const browser = new window.SimulationBrowser(
                            window.DataManager,
                            filter,
                            window.CardRenderer
                        );
                        
                        // Initialize the browser
                        await browser.initialize('.library-container');
                        
                        // Store instance globally for debugging
                        window.SimulationBrowserInstance = browser;
                        console.log('Browse page initialized successfully');
                        
                        // Announce to screen readers
                        if (window.EduLab && window.EduLab.announce) {
                            window.EduLab.announce('Th∆∞ vi·ªán th√≠ nghi·ªám ƒë√£ t·∫£i xong');
                        }

                        // Initialize progress statistics if available
                        if (window.ProgressDisplay) {
                            const progressContainer = document.getElementById('progress-stats-container');
                            if (progressContainer) {
                                window.ProgressDisplay.renderStatistics(progressContainer, {
                                    showRecentActivity: true,
                                    showActions: true
                                });
                            }
                        }
                    } else {
                        throw new Error('SimulationBrowser not available');
                    }

                } catch (error) {
                    console.error('Failed to initialize browse page:', error);
                    showError('C√≥ l·ªói x·∫£y ra khi t·∫£i th∆∞ vi·ªán th√≠ nghi·ªám: ' + error.message);
                }
            }

            async function waitForDependencies() {
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 100;
                    
                    const checkDependencies = () => {
                        if (window.DataManager && 
                            window.ContentFilter && 
                            window.CardRenderer &&
                            window.SimulationBrowser &&
                            typeof window.SimulationBrowser === 'function') {
                            resolve();
                            return;
                        }
                        
                        attempts++;
                        if (attempts >= maxAttempts) {
                            reject(new Error('Required dependencies not loaded after timeout'));
                            return;
                        }
                        
                        setTimeout(checkDependencies, 100);
                    };
                    
                    // Also listen for the SimulationBrowserReady event
                    const onBrowserReady = () => {
                        window.removeEventListener('SimulationBrowserReady', onBrowserReady);
                        resolve();
                    };
                    
                    window.addEventListener('SimulationBrowserReady', onBrowserReady);
                    
                    // Start checking immediately
                    checkDependencies();
                });
            }

            function showError(message) {
                const grid = document.getElementById('simulations-grid');
                if (grid) {
                    grid.innerHTML = `
                        <div style="text-align: center; padding: 4rem 2rem; grid-column: 1 / -1;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">‚ùå</div>
                            <h3 style="color: var(--accent-color); margin-bottom: 1rem;">L·ªói</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 2rem;">${message}</p>
                            <a href="index.html" style="display: inline-block; padding: 12px 24px; background: var(--primary-color); color: white; text-decoration: none; border-radius: 6px;">
                                ‚Üê V·ªÅ trang ch·ªß
                            </a>
                        </div>
                    `;
                }
            }

            // Handle URL parameters for direct linking
            const urlParams = new URLSearchParams(window.location.search);
            
            // Apply URL filters when page loads
            window.addEventListener('load', () => {
                if (window.SimulationBrowser) {
                    const subject = urlParams.get('subject');
                    const grade = urlParams.get('grade');
                    const difficulty = urlParams.get('difficulty');
                    const search = urlParams.get('q');

                    if (subject) window.SimulationBrowser.setSubject(subject);
                    if (grade) window.SimulationBrowser.setGradeLevel(grade);
                    if (difficulty) window.SimulationBrowser.setDifficulty(difficulty);
                    if (search) {
                        const searchInput = document.getElementById('search-input');
                        if (searchInput) {
                            searchInput.value = search;
                            window.SimulationBrowser.setSearch(search);
                        }
                    }
                }
            });

        })();
    </script>
</body>
</html>
